<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GolfStuff - Tournament</title>
</head>

<body>
  <%= render "header_menu" %>

  <div class="row">
    <h1 class="col-xs-10 col-xs-offset-1 tournament-title"><%= @tournament.name %></h1>
  </div>

  <div class="col-xs-10 col-xs-offset-1">

    <!--Show requests-->
    <% if @is_organizer%>
        <%= render partial: "show_requests", locals: {title: "Pending Requests for This Tournament", requests: @tournament.received_requests} %>
    <% end %>

    <!--Play/Sponsor/Organize options-->
      <div class="row tourn-btn-row">

        <div class="col-sm-4 text-center">
          <% if current_user.nil? || !current_user.played_in?(@tournament) %>
              <%= button_to "PLAY!", {:controller => "join", :action => "create", :method=> :post, :params=> {event_id: @tournament.id, join: 0}}, {:class=>"button_new button"} %>
          <% else %>
              <%= button_to "Stop playing", join_path(:params => {:event_id => @tournament.id, :join => 0}), :method=> :delete, data: { confirm: 'Are you sure you want to stop playing?' }, :class=>"button_new_stop button" %>
          <% end %>
        </div>

        <div class="col-sm-4 text-center">
          <% if current_user.nil? || !current_user.organized_a?(@tournament) %>
              <%= button_to "Request to Organize", {:controller => "join", :action => "create", :method=> :post, :params=> {event_id: @tournament.id, join: 1}}, {:class=>"button_new button"} %>
          <% else %>
              <%= button_to "Stop organizing", join_path(:params => {:event_id => @tournament.id, :join => 1}), :method=> :delete, data: { confirm: 'Are you sure you want to stop organizing?' }, :class=>"button_new_stop button" %>
          <% end %>
        </div>

        <div class="col-sm-4 text-center">
            <%= form_tag({:controller=> "join", :action => "create", :params=> {event_id: @tournament.id, join: 2, name: @tournament.name}}) do %>
                <div class="input-group input-group-lg">
                  <%= text_field_tag :sponsor_amount, nil, placeholder: "Donation in CAD", class: "form-control" %>
                  <span class="input-group-btn">
                    <%= submit_tag "Sponsor", :class=>"btn btn-sponsor" %>
                  </span>
                </div>
            <% end %>
        </div>

      </div>
    <!--End of Play/Organize/Sponsor Section-->

    <h2>Players</h2>
    <% if @is_organizer %>
        <%= button_to "Create Group", {:controller => "tournaments", :action => "create_group"}, {:class => "button_new button"} %>
    <% end %>
    <p class="text-muted">Note: Only organizers can put players into groups. In golf games, there can be at most 4 members in every group.</p>


    <% if @tournament.players.any? %>

        <!--Players with group-->
        <% i=0%>
        <% @group_of_groups.each do |pg| %>
            <b><i><%= "Player Group (ID #{@group_id[i]})" %></i></b>
            <% if !current_user.nil? && @is_organizer %>
                <%= button_to "Delete Group", :controller => "tournaments", :action => "delete_group", :params => {:group_id => pg[:id]}, :class => "button_new_stop button" %>
            <% end %>

            <%= render partial: "show_persons_for_one_event", :locals => { :@title => "Player Group (ID #{@group_id[i]})", :@persons => pg[:players], :@player_subgroup => true, :@is_player_group => true} %>

            <% if pg[:players].length<4 && @is_organizer && !@unassigned_players.empty? %>
                <%= form_tag :controller => "tournaments", :action => "add_member", :params => {:group_id => pg[:id], :tournament_id => @tournament.id}  do %>
                    <%= select_tag :added_member, options_for_select(@unassigned_dump), :prompt => "<select a player to add to group>", :include_blank => false %>
                    <%= submit_tag "Add Member to Group" %>
                <% end %>
            <% elsif pg[:players].length==4 && @is_organizer %>
                <i>4 members in group already (group full)</i>
            <% end %>
            <% i+=1 %>
        <% end %>

        <!--Show players without group-->
        <% if !@unassigned_players.empty? %>
            <hr />
            <b><i><%= "Players without group" %></i></b>
            <%= render partial: "show_persons_for_one_event", :locals => { :@title => "Players without Group", :@persons => @unassigned_players, :@player_subgroup => true, :@is_player_group => false, :is_organizer => @is_organizer} %>
        <% end %>

          

    <% else %>
        <h2>Players</h2>
        <div>No players</div>
    <% end %>

    <%= render partial: "show_persons_for_one_event", :locals => { :@title => "Organizers", :@persons => @tournament.organizers, :@player_subgroup => false, :@is_player_group => false, :is_organizer => @is_organizer} %>

    <%= render partial: "show_persons_for_one_event", :locals => { :@title => "Sponsors", :@persons => @tournament.sponsors, :@player_subgroup => false, :@is_player_group => false, :is_organizer => @is_organizer} %>

    <h2>Description</h2>
    <%if @tournament.description.nil?%>
      None
    <% else %>
      <%= @tournament.description %>
  	<% end %>

  </div>
</body>
</html>